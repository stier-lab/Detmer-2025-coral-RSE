---
title: "rse_scenario_analysis"
author: "Raine Detmer"
date: "2025-07-11"
output: html_document
---

README: trying out some initial scenario analyses

To start: use their current framework and vary the lab capacity (with the assumption that all recruits that fit will be kept for one year). So x-axis = lab capacity and y-axis = restoration metrics after some number of years
-- use a matrix from a growing population for the reference site and a matrix from a declining population for the intervention and control sites?
-- and repeat simulations for different mortality parameters for the first size class (e.g., shouldn't matter if they have the same mortality rates). Maybe start with values from that Chamberland paper?

-- start with no external recruitment?

NOTE: should make a function that summarizes model outputs

then repeat with disturbances? (and remember to use new disturbance function for generating disturbance parameters)



from Fundemar data
-- use 0.01 for survival of first size class/newly outplanted recruits

--estimates of number of eggs from colonies (but don't know colony sizes): min = ~5200, 25% quantile = ~30000, 50% = ~93000, 75% = ~100000, max = ~140000, mean = ~72000



load the functions

```{r}

source("coral_demographic_funs.R")
source("rse_funs.R")
```


```{r}
# matrices from Vardi et al 2012
# first year (growing pop'n)
col1 <- c(0.6, 0.15, 0.01, 0)/sum(0.6, 0.15, 0.01, 0)
col2 <- c(0.07, 0.69, 0.11, 0)/sum(0.07, 0.69, 0.11, 0)
col3 <- c(0, 0.1, 0.74, 0.11)/sum(0, 0.1, 0.74, 0.11)
col4 <- c(0, 0.06, 0.11, 0.83)/sum(0, 0.06, 0.11, 0.83)

sum(col1)
sum(col2)
sum(col3)
sum(col4)

#list(col1[2:4], col2[3:4], col3[4], NULL) # growth parameters
#list(NULL, col2[1], col3[1:2], col4[1:3]) # shrinkage

# second year (declining population)
col1 <- c(0.44, 0, 0, 0)/sum(0.44, 0, 0, 0)
col2 <- c(0.14, 0.37, 0.02, 0)/sum(0.14, 0.37, 0.02, 0)
col3 <- c(0.08, 0.19, 0.43, 0)/sum(0.08, 0.19, 0.43, 0)
col4 <- c(0, 0, 0.13, 0.71)/sum(0, 0, 0.13, 0.71)

sum(col1)
sum(col2)
sum(col3)
sum(col4)

list(col1[2:4], col2[3:4], col3[4], NULL) # growth parameters
list(NULL, col2[1], col3[1:2], col4[1:3]) # shrinkage

```


parameter setup
```{r}

years <- 20
n <- 5

A_mids <- c(0.1, 43, 369, 2158, 11171) # mean areas in each size class (cm^2)


orchard_treatments <- c("none", "algae") # two orchards
reef_treatments <- c("none", "intervention") # reef (natural population and intervention site; note don't have a "control" because just include that as one of the simulations)
lab_treatments <- c("0_tile1", "1_tile1") # lab (outplant immediately or retain for a year)

# demographic parameters for each orchard and reef treatment
# reef parameters: survival
surv_pars.r <- list()
surv_pars.r[[1]] <- list() # first reef subpop (reference reef) 
surv_pars.r[[1]][[1]] <- c(0.010, 0.760, 0.870, 0.950, 0.999) # survival probabilities for first source of recruits to first reef (external recruits); from 1st matrix in Vardi et al. 2012
surv_pars.r[[2]] <- list() # second reef subpop (intervention reef)
surv_pars.r[[2]][[1]] <- c(0.010, 0.44, 0.53, 0.70, 0.84) # survival probabilities for first source of recruits to second reef subpop (external recruits); from 2nd matrix in Vardi et al. 2012
surv_pars.r[[2]][[2]] <- surv_pars.r[[2]][[1]] # survival probabilities for second source of recruits to second reef subpop (first lab treatment)
surv_pars.r[[2]][[3]] <- surv_pars.r[[2]][[1]] # survival probabilities for third source of recruits to second reef subpop (second lab treatment)

# reef parameters: growth
growth_pars.r <- list()
growth_pars.r[[1]] <- list() # first reef subpop
growth_pars.r[[1]][[1]] <- list(c(0.85, 0, 0, 0), c(0.197, 0.0132, 0), c(0.126, 0), 0.1158, NULL) # first source to first reef subpop (external recruits)

growth_pars.r[[2]] <- list() # second reef subpop (intervention)
growth_pars.r[[2]][[1]] <- list(c(0.7, 0, 0, 0), c(0, 0, 0), c(0.038, 0), 0, NULL) # first source (ext recruits)
growth_pars.r[[2]][[2]] <- growth_pars.r[[1]][[1]] # second source (first lab treatment)
growth_pars.r[[2]][[3]] <- growth_pars.r[[1]][[1]] # third source (third lab treatment)

# reef parameters: shrinkage
shrink_pars.r <- list()
shrink_pars.r[[1]] <- list() # first subpop
shrink_pars.r[[1]][[1]] <- list(NULL, c(0.01), c(0, 0.08), c(0, 0, 0.105), c(0, 0, 0.06, 0.11)) # first source

shrink_pars.r[[2]] <- list() # second subpop
shrink_pars.r[[2]][[1]] <- list(NULL, c(0.01), c(0, 0.026), c(0, 0.11, 0.27), c(0, 0, 0, 0.15)) # first source 
shrink_pars.r[[2]][[2]] <- shrink_pars.r[[2]][[1]] # second source
shrink_pars.r[[2]][[3]] <- shrink_pars.r[[2]][[1]] # third source

# reef parameters: fragmentation
frag_pars.r <- list()
frag_pars.r[[1]] <- list() # first subpop
frag_pars.r[[1]][[1]] <- list(NULL, c(0), c(0, 0), c(0, 0.06, 0.06), c(0, 0.28, 0.3, 0.23)) # first source
#frag_pars.r[[1]][[1]] <- list(NULL, c(0), c(0, 0), c(0, 0, 0), c(0, 0, 0, 0))

frag_pars.r[[2]] <- list() # second subpop
frag_pars.r[[2]][[1]] <- list(NULL, c(0), c(0, 0), c(0, 0.03, 0.03), c(0, 0.19, 0.16, 0)) # first source
frag_pars.r[[2]][[2]] <- frag_pars.r[[2]][[1]] # second source
frag_pars.r[[2]][[3]] <- frag_pars.r[[2]][[1]] # third source

# reef parameters: fecundity
fec_pars.r <- list()
fec_pars.r[[1]] <- list() # first subpop
fec_pars.r[[1]][[1]] <- c(0, 0, 5000, 50000, 100000) # first source

fec_pars.r[[2]] <- list()
fec_pars.r[[2]][[1]] <- fec_pars.r[[1]][[1]]
fec_pars.r[[2]][[2]] <- fec_pars.r[[1]][[1]]
fec_pars.r[[2]][[3]] <- fec_pars.r[[1]][[1]]

# orchard parameters: survival
surv_pars.o <- list()
surv_pars.o[[1]] <- list() # first treatment
surv_pars.o[[1]][[1]] <- 1- c(0.99, 0.24, 0.13, 0.05, 0.001) # first source (first lab treatment)
surv_pars.o[[1]][[2]] <- surv_pars.o[[1]][[1]] # second source (second lab treatment)

surv_pars.o[[2]] <- list() # second treatment
surv_pars.o[[2]][[1]] <- surv_pars.o[[1]][[1]] # first source (first lab treatment)
surv_pars.o[[2]][[2]] <- surv_pars.o[[1]][[1]] # second source (second lab treatment)

# orchard parameters: growth
growth_pars.o <- list()
growth_pars.o[[1]] <- list() # first treatment
growth_pars.o[[1]][[1]] <- list(c(0.85, 0, 0, 0), c(0.197, 0.0132, 0), c(0.126, 0), 0.1158, NULL) # first source
growth_pars.o[[1]][[2]] <- growth_pars.o[[1]][[1]] # second source

growth_pars.o[[2]] <- list() # second treatment
growth_pars.o[[2]][[1]] <-growth_pars.o[[1]][[1]] # first source
growth_pars.o[[2]][[2]] <- growth_pars.o[[1]][[1]] # second source

# orchard parameters: shrinkage
shrink_pars.o <- list()
shrink_pars.o[[1]] <- list() # first treatment
shrink_pars.o[[1]][[1]] <- list(NULL, c(0.01), c(0, 0.08), c(0, 0, 0.105), c(0, 0, 0.06, 0.11)) # first source
shrink_pars.o[[1]][[2]] <- shrink_pars.o[[1]][[1]] # second source

shrink_pars.o[[2]] <- list() # second treatment
shrink_pars.o[[2]][[1]] <- shrink_pars.o[[1]][[1]] # first source
shrink_pars.o[[2]][[2]] <- shrink_pars.o[[1]][[1]] # second source

# orchard parameters: fragmentation
frag_pars.o <- list()
frag_pars.o[[1]] <- list() # first treatment
frag_pars.o[[1]][[1]] <- list(NULL, c(0), c(0, 0), c(0, 0, 0), c(0, 0, 0, 0)) # first source
frag_pars.o[[1]][[2]] <- frag_pars.o[[1]][[1]] # second source

frag_pars.o[[2]] <- list() # second treatment
frag_pars.o[[2]][[1]] <- frag_pars.o[[1]][[1]] # first source
frag_pars.o[[2]][[2]] <- frag_pars.o[[1]][[1]] # second source

fec_pars.o <- list()
fec_pars.o[[1]] <- list() # first treatment
fec_pars.o[[1]][[1]] <- c(0, 0, 0.1, 1, 2) # first source
fec_pars.o[[1]][[2]] <- fec_pars.o[[1]][[1]] # second source

fec_pars.o[[2]] <- list() # second treatment
fec_pars.o[[2]][[1]] <- c(0, 0, 0.1, 1, 2) # first source
fec_pars.o[[2]][[2]] <- fec_pars.o[[1]][[1]] # second source

lambda <- 0 # external recruitment to reef

# stochasticity parameters
sigma_s <- 0
sigma_f <- 0
ext_rand <- FALSE
seeds <- c(1000, 5000, 10000)

# initial conditions in each reef subpopulation
N0.r <- list()
N0.r[[1]] <- list() # first reef subpop
N0.r[[1]][[1]] <- c(10, 20, 20, 15, 5) # first source in first reef subpop (reference reef)
N0.r[[2]] <- list() # second reef subpop
N0.r[[2]][[1]] <- rep(1, n) # first source
N0.r[[2]][[2]] <- rep(1, n) # second source
N0.r[[2]][[3]] <- rep(1, n) # third source

# intial conditions in each orchard subpopulation
N0.o <- list()
N0.o[[1]] <- list() # first orchard treatment
N0.o[[1]][[1]] <- rep(1, n) # first source
N0.o[[1]][[2]] <- rep(1, n) # second source
N0.o[[2]] <- list() # second orchard treatment
N0.o[[2]][[1]] <- rep(1, n) # first source
N0.o[[2]][[2]] <- rep(1, n) # second source

N0.l <- list()
N0.l[[1]] <- 1
N0.l[[2]] <- 1


# disturbance parameters
dist_yrs <- c(years + 10) # years when disturbance occurs, NA if none

# effects of disturbance on each reef subpop
dist_effects.r <- list()
dist_effects.r[[1]] <- list() # list where each element is the effects of disturbnce on corals from each source in the 1st reef subpop
dist_effects.r[[1]][[1]] <- list() # effects of disturbances on corals from first source in first reef subpop
dist_effects.r[[1]][[1]][[1]] <- c("survival") # effects of 1st disturbance on corals from first source in first reef subpop ([[1]][[1]][[2]] would be second disturbance, etc.)

# second reef subpop
dist_effects.r[[2]] <- list() 
dist_effects.r[[2]][[1]] <- list() # first source
dist_effects.r[[2]][[1]][[1]] <- c("survival")
dist_effects.r[[2]][[2]] <- list() # second source
dist_effects.r[[2]][[2]][[1]] <- c("survival")
dist_effects.r[[2]][[3]] <- list() # third source
dist_effects.r[[2]][[3]][[1]] <- c("survival")


# disturbance parameters for each reef subpop
dist_pars.r <- list()

# first reef subpop
dist_pars.r[[1]] <- list() # first source in first reef subpop
dist_pars.r[[1]][[1]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.r[[1]][[1]], dist_surv0 = list(surv_pars.r[[1]][[1]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL) # list of disturbance parameters for the third source in the third reef population (defaults for each parameter type are NULL unless the disturbance affects them, as specified in dist_effects)
# dist_surv0 = list where ith element is the survival probabilities for the ith disturbance

# second reef subpop
dist_pars.r[[2]] <- list() 
# first source to second reef subpop
dist_pars.r[[2]][[1]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.r[[2]][[1]], dist_surv0 = list(surv_pars.r[[2]][[1]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL)
# second source to second reef subpop
dist_pars.r[[2]][[2]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.r[[2]][[2]], dist_surv0 = list(surv_pars.r[[2]][[2]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL)
# third source to second reef subpop
dist_pars.r[[2]][[3]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.r[[2]][[3]], dist_surv0 = list(surv_pars.r[[2]][[3]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL)

# disturbance effects for each orchard subpop
dist_effects.o <- list()

dist_effects.o[[1]] <- list() # list where each element is the effects of disturbnce on corals from each source in the 1st orchard treatment
dist_effects.o[[1]][[1]] <- list() # effects of disturbances on corals from first source in first orchard treatment
dist_effects.o[[1]][[1]][[1]] <- c("survival") # effects of 1st disturbance on corals from first source in first reef subpop ([[1]][[1]][[2]] would be second disturbance, etc.)
dist_effects.o[[1]][[2]] <- list() # second source
dist_effects.o[[1]][[2]][[1]] <- c("survival")

# second orchard treatment
dist_effects.o[[2]] <- list() 
dist_effects.o[[2]][[1]] <- list() # first source
dist_effects.o[[2]][[1]][[1]] <- c("survival") 
dist_effects.o[[2]][[2]] <- list() # second source
dist_effects.o[[2]][[2]][[1]] <- c("survival")

# disturbance parameters for each orchard subpop
dist_pars.o <- list()

# first orchard treatment
dist_pars.o[[1]] <- list() 
# first source in first orchard treatment
dist_pars.o[[1]][[1]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.o[[1]][[1]], dist_surv0 = list(surv_pars.o[[1]][[1]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL) 
# second source in first orchard treatment
dist_pars.o[[1]][[2]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.o[[1]][[2]], dist_surv0 = list(surv_pars.o[[1]][[2]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL)

# second orchard treatment
dist_pars.o[[2]] <- list() 
# first source in second orchard treatment
dist_pars.o[[2]][[1]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.o[[2]][[1]], dist_surv0 = list(surv_pars.o[[2]][[1]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL) 
# second source in second orchard treatment
dist_pars.o[[2]][[2]] <- dist_pars_fun(dist_yrs = dist_yrs, dist_effects.o[[2]][[2]], dist_surv0 = list(surv_pars.o[[2]][[2]]*0.1), dist_Tmat0 = NULL, dist_Fmat0 = NULL, dist_fec0 = NULL)


# lab parameters
sett <- c(0.1, 0.1) # fraction of larvae that successfully settle in each lab treatment
s <- c(0.9, 0.7) # fraction of settled larvae in each lab treatment that survive to time of outplanting
# lab_treatments <- c("0_tile1", "1_tile1") # lab
size_props <- matrix(NA, nrow = length(lab_treatments), ncol = n) # matrix for fractions of retained recruits in each size class at the end of their year in the lab
size_props[1, ] <- c(1, 0, 0, 0, 0) # first lab treatment
size_props[2, ] <- c(0.2, 0.8, 0, 0, 0) # second lab treatment
lab_pars <- list(sett = sett, s = s, size_props = size_props)


# restoration strategy parameters
orchard_yield <- 0 # percent of new orchard babies successfully collected
reef_yield <- 0.0005 # percent of new reef babies successfully collected and fertilized
lab_props <- c(0.5, 0.5) # proportion of new babies put in each lab treatment
reef_prop <- c(1, 1) # proportion of lab recruits from each lab treatment outplanted to reef (1-proportion outplanted to orchard)
reef_out_props <- matrix(NA, nrow = length(lab_treatments), ncol = length(reef_treatments)) # proportion recruits going from each lab treatment to each reef treatment (row = origin lab treatment, column = destination reef treatment)
reef_out_props[1,] <- c(0, 1) # from first lab treatment to each reef treatment (note the "none" reef treatment shouldn't get any outplants)
reef_out_props[2,] <- c(0, 1) # from second lab treatment to each reef treatment (note the "none" reef treatment shouldn't get any outplants)

orchard_out_props <- matrix(NA, nrow = length(lab_treatments), ncol = length(orchard_treatments)) # proportion recruits going from each lab treatment to each orchard treatment
orchard_out_props[1,] <- c(0.5, 0.5) # from first lab treatment to each orchard treatment
orchard_out_props[2,] <- c(0.5, 0.5) # from second lab treatment to each orchard treatment

# sizes allocated to each treatment
reef_areas <- c(100, 100)*10000 # m^2 given to each reef treatment (make sure to include none -- sum of reef_areas should be size of reef), convert to cm^2
lab_max <- c(1000, 1000) # number of settlers that can fit in each lab treatment
orchard_size <- c(200, 200) # number of individuals each orchard treatment has space for

# coral transplanting
transplant <- rep(0, years)
#transplant[10] <- 1 # in 10th year, move corals from orchard to reef

# rest_pars$trans_mats[[ss]][[rr]][i,]
null_mat <- matrix(0, nrow = years, ncol = n)
trans_mats <- list()
trans_mats[[1]] <- list() # first treatment
trans_mats[[1]][[1]] <- null_mat
#trans_mats[[1]][[1]][which(transplant!=0)[1],] <- c(0, 0, 0, 2,0)# number of colonies of each size class to move to reef in first transplant event
trans_mats[[1]][[2]] <- null_mat # second source

trans_mats[[2]] <- list() # second treatment
trans_mats[[2]][[1]] <- null_mat # first source
trans_mats[[2]][[2]] <- null_mat # second source

#rest_pars$trans_reef[[ss]][[rr]][i,1]
trans_reef <- list()
null_mat2 <- matrix(1, nrow = years, ncol = 2)
trans_reef[[1]] <- list() # first treatment
trans_reef[[1]][[1]] <- null_mat2
#trans_reef[[1]][[1]][which(transplant!=0)[1],] <- c(2, 1)# reef area and subpopulation to transport the corals to
trans_reef[[1]][[2]] <- null_mat2 # second source

trans_reef[[2]] <- list() # second treatment
trans_reef[[2]][[1]] <- null_mat2# first source
trans_reef[[2]][[2]] <- null_mat2 # second source

rest_pars <- list(orchard_yield = orchard_yield, reef_yield = reef_yield, lab_props = lab_props, reef_prop = reef_prop, reef_out_props = reef_out_props, orchard_out_props = orchard_out_props, reef_areas = reef_areas, lab_max = lab_max, orchard_size = orchard_size, transplant = transplant, trans_mats = trans_mats, trans_reef = trans_reef)




sim1 <- rse_mod(years, n, A_mids, surv_pars.r, growth_pars.r, shrink_pars.r, frag_pars.r, fec_pars.r, surv_pars.o, growth_pars.o, shrink_pars.o, frag_pars.o, fec_pars.o, lambda, sigma_s, sigma_f, ext_rand, seeds, dist_yrs, dist_pars.r, dist_effects.r, dist_pars.o, dist_effects.o, orchard_treatments, reef_treatments, lab_treatments, lab_pars, rest_pars, N0.r, N0.o, N0.l)

```


```{r}

# plot results

reef1_tot <- apply(sim1$reef_pops[[1]][[1]], MARGIN = 2, sum) 
reef2_tot <- apply(sim1$reef_pops[[2]][[1]], MARGIN = 2, sum) + apply(sim1$reef_pops[[2]][[2]], MARGIN = 2, sum) + apply(sim1$reef_pops[[2]][[3]], MARGIN = 2, sum)

orch1_tot <- apply(sim1$orchard_pops[[1]][[1]], MARGIN = 2, sum) + apply(sim1$orchard_pops[[1]][[2]], MARGIN = 2, sum)
orch2_tot <- apply(sim1$orchard_pops[[2]][[1]], MARGIN = 2, sum) + apply(sim1$orchard_pops[[2]][[2]], MARGIN = 2, sum)


plot(x = c(1:years), y = reef1_tot, type = "l", las = 1, ylim = c(0, max(reef1_tot, reef2_tot, orch1_tot, orch2_tot)), xlab = "year", ylab = "Pop'n size", lwd = 2)
lines(x = c(1:years), y = reef2_tot, type = "l", lwd = 2, lty = 2)
lines(x = c(1:years), y = orch1_tot, type = "l", col = "dodgerblue", lwd = 2, lty = 1)
lines(x = c(1:years), y = orch2_tot, type = "l", col = "dodgerblue", lwd = 3, lty = 2)
legend("topleft", legend = c("reef", "orchard"), col = c("black", "dodgerblue"), lwd = 2, lty = c(1, 1))

```


simulations: vary the number that can go in the 1 year outplant treatment and record the number after 5 years and 10 years


NOTE: since the orchard isn't doing anything right now, just put all the lab recruits on the reef

```{r}

#max_set <- seq(from = 0, to = 100, length.out = 20)

prop_set <- seq(from = 0, to = 1, length.out = 20)

# holding vectors
# reef population sizes at 5 years
reef1.5 <- rep(NA, length(prop_set))
reef2.5 <- rep(NA, length(prop_set))

# reef population sizes at 10 years
reef1.10 <- rep(NA, length(prop_set))
reef2.10 <- rep(NA, length(prop_set))

# intervention reef reproductive output at 5 years
rep1.5 <- rep(NA, length(prop_set))
rep2.5 <- rep(NA, length(prop_set))

# intervention reef reproductive output at 10 years
rep1.10 <- rep(NA, length(prop_set))
rep2.10 <- rep(NA, length(prop_set))

for(i in 1:length(prop_set)){
  
  #lab_max.i <- c(100, prop_set[i])
  lab_props.i <- c(1-prop_set[i], prop_set[i])
  
rest_pars.i <- list(orchard_yield = orchard_yield, reef_yield = reef_yield, lab_props = lab_props.i, reef_prop = reef_prop, reef_out_props = reef_out_props, orchard_out_props = orchard_out_props, reef_areas = reef_areas, lab_max = lab_max.i, orchard_size = orchard_size, transplant = transplant, trans_mats = trans_mats, trans_reef = trans_reef)

sim.i <- rse_mod(years, n, A_mids, surv_pars.r, growth_pars.r, shrink_pars.r, frag_pars.r, fec_pars.r, surv_pars.o, growth_pars.o, shrink_pars.o, frag_pars.o, fec_pars.o, lambda, sigma_s, sigma_f, ext_rand, seeds, dist_yrs, dist_pars.r, dist_effects.r, dist_pars.o, dist_effects.o, orchard_treatments, reef_treatments, lab_treatments, lab_pars, rest_pars.i, N0.r, N0.o, N0.l)
  
  
# save the results
reef1.5[i] <- sum(sim.i$reef_pops[[1]][[1]][,5])
reef2.5[i] <- sum(sim.i$reef_pops[[2]][[1]][,5]) + sum(sim.i$reef_pops[[2]][[2]][,5]) + sum(sim.i$reef_pops[[2]][[3]][,5])
reef1.10[i] <- sum(sim.i$reef_pops[[1]][[1]][,10])
reef2.10[i] <- sum(sim.i$reef_pops[[2]][[1]][,10]) + sum(sim.i$reef_pops[[2]][[2]][,10]) + sum(sim.i$reef_pops[[2]][[3]][,10])

# intervention reef reproductive output at 5 years
rep1.5[i] <- sum(sim.i$reef_pops[[1]][[1]][,5]*fec_pars.r[[1]][[1]])
rep2.5[i] <- sum(sim.i$reef_pops[[2]][[1]][,5]*fec_pars.r[[2]][[1]]) + sum(sim.i$reef_pops[[2]][[2]][,5]*fec_pars.r[[2]][[2]]) + sum(sim.i$reef_pops[[2]][[3]][,5]*fec_pars.r[[2]][[3]])

# intervention reef reproductive output at 10 years
rep1.10[i] <- sum(sim.i$reef_pops[[1]][[1]][,10]*fec_pars.r[[1]][[1]])
rep2.10[i] <- sum(sim.i$reef_pops[[2]][[1]][,10]*fec_pars.r[[2]][[1]]) + sum(sim.i$reef_pops[[2]][[2]][,10]*fec_pars.r[[2]][[2]]) + sum(sim.i$reef_pops[[2]][[3]][,10]*fec_pars.r[[2]][[3]])

}

```

will want to repeat this for different lab growth rates



```{r}
plot(x = prop_set, y = reef2.5, type = "l", las = 1)
lines(x = prop_set, y = reef1.5, lty = 2)

plot(x = prop_set, y = reef2.10, type = "l", las = 1)
lines(x = prop_set, y = reef1.10, lty = 2)

```


with the proportion version, see a decline at high proportions because then you lose the immediate outplants...need to redo the lab treatments

currently have numbers that can fit in each lab treatment and the proportions of larvae collected that can go in each treatment (max capacity)... should I change that? the proportion part will get more complicated if treatments include different tiles where settlement is more random, so will probably need to end up giving 1 yr priority and fill up all the one year spots first and then put the rest in the immediate outplanting case. and then there will be some total lab capacity as well


